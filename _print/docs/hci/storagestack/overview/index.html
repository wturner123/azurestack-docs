<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="canonical" type="text/html" href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/">
<link rel="alternate" type="application/rss&#43;xml" href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/azurestack-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/azurestack-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/azurestack-docs/favicons/android-192x192.png" sizes="192x192">

<title>Storage Stack Overview | Solutions for Microsoft Azure</title>
<meta name="description" content="Understanding storage stack is crucial for understanding what technologies are involved and how (where storage replica is, where is ReFS Multi-resilient Volume, …). Understanding how layers are stacked will also help when IO flow is troubleshooted - like reviewing performance counters or troubleshooting core functionality.
Traditional stack compared to storage spaces stack (note that MPIO is missing, but for Storage Spaces Direct it’s not needed as there is only one path to the physical device, so it was omitted)">
<meta property="og:url" content="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/">
  <meta property="og:site_name" content="Solutions for Microsoft Azure">
  <meta property="og:title" content="Storage Stack Overview">
  <meta property="og:description" content="Understanding storage stack is crucial for understanding what technologies are involved and how (where storage replica is, where is ReFS Multi-resilient Volume, …). Understanding how layers are stacked will also help when IO flow is troubleshooted - like reviewing performance counters or troubleshooting core functionality.
Traditional stack compared to storage spaces stack (note that MPIO is missing, but for Storage Spaces Direct it’s not needed as there is only one path to the physical device, so it was omitted)">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="Storage Stack Overview">
  <meta itemprop="description" content="Understanding storage stack is crucial for understanding what technologies are involved and how (where storage replica is, where is ReFS Multi-resilient Volume, …). Understanding how layers are stacked will also help when IO flow is troubleshooted - like reviewing performance counters or troubleshooting core functionality.
Traditional stack compared to storage spaces stack (note that MPIO is missing, but for Storage Spaces Direct it’s not needed as there is only one path to the physical device, so it was omitted)">
  <meta itemprop="dateModified" content="2026-01-06T09:36:02-06:00">
  <meta itemprop="wordCount" content="717">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Storage Stack Overview">
  <meta name="twitter:description" content="Understanding storage stack is crucial for understanding what technologies are involved and how (where storage replica is, where is ReFS Multi-resilient Volume, …). Understanding how layers are stacked will also help when IO flow is troubleshooted - like reviewing performance counters or troubleshooting core functionality.
Traditional stack compared to storage spaces stack (note that MPIO is missing, but for Storage Spaces Direct it’s not needed as there is only one path to the physical device, so it was omitted)">



<link rel="preload" href="https://wturner123.github.io/azurestack-docs/scss/main.min.4be8cdcf78a52ff9809ae73a7245abb788ca6ce762500dcb809e2dc2750919a0.css" as="style">
<link href="https://wturner123.github.io/azurestack-docs/scss/main.min.4be8cdcf78a52ff9809ae73a7245abb788ca6ce762500dcb809e2dc2750919a0.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="/azurestack-docs/css/prism.css"/>
<link disabled id="prism-night-owl" rel="stylesheet" href='/azurestack-docs/css/prism-nightowl.css'>
<link id="home-page-override" rel="stylesheet" href='/azurestack-docs/css/homepage.css'>
<link rel="stylesheet" href='/azurestack-docs/css/cookie-consent.css'>

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-PXKTSNG8VW"></script>
      <script>
        function getConsentAnalytics() {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; azs-cookie-consent=`);
            var cookieAnalytics = false;
            if (parts.length === 2) {
                try {
                    cookieAnalytics = (JSON.parse(decodeURIComponent(parts.pop().split(';').shift()))).analytics;
                } catch (e) {
                    cookieAnalytics = false;
                }
            }
            return cookieAnalytics;
        }
        var doNotTrack = false;
        if ( true ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack && getConsentAnalytics()) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-PXKTSNG8VW');
        }
      </script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="/azurestack-docs/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1017 132"><defs><style>.cls-1{fill:#fff}</style></defs><title>DellTech_Logo_Prm_Wht_rgb</title><path class="cls-1" d="M1015 84.89c0-12.23-6.8-17.66-20.39-20.38s-21.73-4.08-21.73-13.58c0-6.8 5.44-10.87 15-10.87 12.22.0 16.3 5.43 16.3 12.22l1.36 1.36h5.43l1.37-1.36c0-13.58-10.88-19-24.46-19-15 0-23.1 8.15-23.1 17.67.0 10.86 8.15 16.3 21.73 19s20.38 4.08 20.38 15c0 6.79-4.07 12.23-17.66 12.23-12.22.0-17.66-6.8-17.66-15l-1.35-1.36h-5.44l-1.35 1.36c0 12.23 9.5 21.74 25.8 21.74 17.66.0 25.82-8.15 25.82-19M956.58 71.31l1.36-1.37V65.87c0-19-10.87-32.61-29.89-32.61s-29.89 13.59-29.89 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38l-1.36-1.36h-5.43l-1.36 1.36c-2.72 8.15-8.16 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H907.67l-1.36-1.36c0-9.51 5.44-23.09 21.74-23.09s21.74 13.58 21.74 23.09zm-59.78 36.68V36l-1.36-1.35h-5.43L880.5 36v65.22l1.36 1.36h5.43zm0-78.8V14.24l-1.36-1.36h-5.43l-1.36 1.36v8.15l1.36 1.36h5.43zM837 97.12c-13.59.0-21.74-9.52-21.74-28.53S823.44 40.06 837 40.06s21.73 9.5 21.73 28.53S850.61 97.12 837 97.12M858.76 93c0 17.66-4.07 31.25-20.38 31.25-12.22.0-16.3-5.44-17.66-12.23l-1.35-1.36h-5.44l-1.36 1.36c1.36 10.87 9.51 19 25.81 19 17.67.0 28.53-10.87 28.53-38V36l-1.35-1.35h-4.08L860.12 36l-1.36 8.16H857.4c-2.71-5.43-9.5-10.87-21.74-10.87-19 0-28.53 15-28.53 35.33s9.52 35.32 28.53 35.32c12.24.0 19-5.43 21.74-10.87zm-88.3-53c13.58.0 23.09 10.87 23.09 28.53S784 97.12 770.46 97.12s-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32s-13.59-35.33-31.25-35.33-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-40.76-2.72V8.81l-1.36-1.36h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43zM680.8 40.06c13.58.0 23.09 10.87 23.09 28.53s-9.51 28.53-23.09 28.53-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32S698.46 33.26 680.8 33.26s-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-39.4-2.72V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.67 4.08-21.74 10.87h-1.36L592.49 36l-1.36-1.35h-4.08L585.7 36v65.22l1.35 1.36h5.44l1.36-1.36V64.51c0-15 6.79-24.45 21.73-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.37 1.36H640zm-69.29.0V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.66 4.08-21.74 10.87h-1.36V8.81L523.2 7.45h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43l1.36-1.36V64.51c0-15 6.8-24.45 21.74-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.36 1.36h5.44zM455.28 68.59c0-19 9.5-28.53 23.09-28.53s19 8.15 20.38 16.29l1.35 1.37h5.44l1.36-1.37c-1.36-13.58-12.23-23.09-28.53-23.09-17.66.0-31.24 10.87-31.24 35.33s13.58 35.32 31.24 35.32c16.3.0 27.17-9.51 28.53-23.1l-1.36-1.36H500.1l-1.35 1.36C497.39 89 492 97.12 478.37 97.12s-23.09-9.52-23.09-28.53m-14.95 2.72 1.36-1.37V65.87c0-19-10.87-32.61-29.9-32.61s-29.88 13.59-29.88 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38L439 82.17h-5.43l-1.36 1.36c-2.72 8.15-8.15 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H391.42l-1.36-1.36c0-9.51 5.44-23.09 21.73-23.09s21.75 13.58 21.75 23.09zM395.57 12.88V8.81l-1.36-1.36H323.56L322.2 8.81v4.07l1.36 1.36h29.89l1.36 1.36v85.59l1.36 1.36h5.43l1.36-1.36V15.6l1.36-1.36h29.89z"/><path class="cls-1" d="M322.2 83.65v18.9H260.85V7.45h21.6v76.2zM38.55 102.55A47.57 47.57.0 0084.58 67l53.8 42 53.77-42v35.56H253.5V83.65H213.75V7.45h-21.6V43L140.58 83.3l-11.54-9L153.73 55l26.89-21-15.35-12-51.58 40.3-11.53-9L153.73 13 138.38 1 84.58 43a47.57 47.57.0 00-46-35.58H0v95.1zM21.6 83.65V26.35H38.55c14.33.0 26 12.83 26 28.65s-11.67 28.65-26 28.65z"/></svg></span><span class="navbar-brand__name">Solutions for Microsoft Azure</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="/azurestack-docs/docs/"><span>Dell Technologies Solutions for Microsoft Azure</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/dell/azurestack-docs" target="_blank" rel="noopener"><i class='fab fa-github fa-lg'></i><span>GitHub</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="/azurestack-docs/offline-search-index.dd90545b0d10ed12aaf0226c82ecc1d7.json"
    data-offline-search-base-href="/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/azurestack-docs/docs/hci/storagestack/overview/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Storage Stack Overview</h1>





  
  <nav id="TableOfContents">
  <ul>
    <li><a href="#layers-below-s2d-stack">Layers below S2D Stack</a>
      <ul>
        <li><a href="#port--miniport-driver">Port &amp; Miniport driver</a></li>
        <li><a href="#class-driver">Class Driver</a></li>
        <li><a href="#partition-manager">Partition Manager</a></li>
      </ul>
    </li>
    <li><a href="#s2d-stack">S2D Stack</a>
      <ul>
        <li><a href="#storage-bus-layer">Storage Bus Layer</a></li>
        <li><a href="#spaceport">Spaceport</a></li>
        <li><a href="#virtual-disk">Virtual Disk</a></li>
      </ul>
    </li>
    <li><a href="#layers-above-s2d-stack">Layers above S2D Stack</a>
      <ul>
        <li><a href="#volume-manager">Volume Manager</a></li>
        <li><a href="#volume-snapshot">Volume Snapshot</a></li>
        <li><a href="#bitlocker">BitLocker</a></li>
        <li><a href="#filter-drivers">Filter Drivers</a></li>
      </ul>
</nav>
  


<div class="content">
      <p>Understanding storage stack is crucial for understanding what technologies are involved and how (where storage replica is, where is ReFS Multi-resilient Volume, &hellip;). Understanding how layers are stacked will also help when IO flow is troubleshooted - like reviewing performance counters or troubleshooting core functionality.</p>
<p>Traditional stack compared to storage spaces stack (note that MPIO is missing, but for Storage Spaces Direct it&rsquo;s not needed as there is only one path to the physical device, so it was omitted)</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack01.png
" alt=""></p>
<p>You can notice 4 &ldquo;new&rdquo; layers, but actually it&rsquo;s just Spaces layer (Spaceport) and Storage Bus Layer.</p>
<p>To better understand what&rsquo;s in the stack, you can also explore some parts with PowerShell</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack02.png
" alt=""></p>
<p>Anyway, let&rsquo;s explore layers a bit. Following info is based on storage description someone somewhere created and pushed to internet. The only version found was from webarchive and can be accessed <a href="/azurestack-docs/docs/hci/storagestack/overview/Storage.pdf">here</a>.</p>
<h2 id="layers-below-s2d-stack">Layers below S2D Stack</h2>
<h3 id="port--miniport-driver">Port &amp; Miniport driver</h3>
<p><em><strong>storport.sys</strong></em> &amp; <em><strong>stornvme.sys</strong></em></p>
<p>Port drivers implement the processing of an I/O request specific to a type of I/O port, such as SATA, and are implemented as kernel-mode libraries of functions rather than actual device drivers. Port driver is written by Microsoft (<em><strong>storport.sys</strong></em>). If third party wants to use write their own device driver (like HBA), then it will use miniport driver (except if device is NVMe, then miniport driver is Microsoft <em><strong>stornvme.sys</strong></em>)</p>
<p>Miniport drivers usually use <em><strong>storport.</strong></em> performance enhancements such as support for the paralell execution of IO.</p>
<p><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/storage-port-drivers">storage port drivers</a>
<a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/storage-miniport-drivers">storage miniport drivers</a></p>
<h3 id="class-driver">Class Driver</h3>
<p><em><strong>disk.sys</strong></em></p>
<p>A <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/introduction-to-storage-class-drivers">storage class driver</a> (typically <em><strong>disk.sys</strong></em>) uses the well-established SCSI class/port interface to control a mass storage device of its type on any bus for which the system supplies a storage port driver (currently SCSI, IDE, USB and IEEE 1394). The particular bus to which a storage device is connected is transparent to the storage class driver.</p>
<p>Storage class driver is responsible for claiming devices, interpreting system I/O requests and <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/storage/storage-class-driver-s-general-functionality">many more</a></p>
<p>In Storage Spaces stack (Virtual Disk) <em><strong>disk.sys</strong></em> is responsible for claiming Virtual Disk exposed by spaceport (storage spaces)</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack03.png
" alt=""></p>
<h3 id="partition-manager">Partition Manager</h3>
<p><em><strong>partmgr.sys</strong></em></p>
<p>Partitions are handled by <em><strong>partmgr.sys</strong></em>. Partition is usually GPT or MBR (preferably GPT as MBR has many limitations such as 2TB size limit)</p>
<p>As you can see in the stack, there are two partition managers. One partition layout is on physical disk and it is then consumed by storage spaces (spaceport).</p>
<p>On the picture below you can see individual physical disk from spaces exposed and it&rsquo;s partitions showing metadata partition and partition containing pool data (normally not visible as it&rsquo;s hidden by <em><strong>partmgr.sys</strong></em> when it detects spaces).</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack04.png
" alt=""></p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack05.png
" alt=""></p>
<h2 id="s2d-stack">S2D Stack</h2>
<h3 id="storage-bus-layer">Storage Bus Layer</h3>
<p><em><strong>clusport.sys</strong></em> and <em><strong>clusblft.sys</strong></em></p>
<p>These two drivers (client/server) are exposing all physical disk to each cluster node, so it looks like all physical disks from every cluster node are connected to each server. For interconnect is SMB used, therefore high-speed RDMA can be used (recommended).</p>
<p>It also contains SBL cache.</p>
<h3 id="spaceport">Spaceport</h3>
<p><em><strong>spaceport.sys</strong></em></p>
<p>Claims disks and adds them to storage spaces pool. It creates partitions where internal data structures are metadata are kept (see screenshot in partition manager).</p>
<p>Defines resiliency when volume (virtual disk) is created (creates/distributes extents across physical disks)</p>
<h3 id="virtual-disk">Virtual Disk</h3>
<p><em><strong>disk.sys</strong></em> is now used by storage spaces and exposes virtual disk that was provisioned using <em><strong>spaceport.sys</strong></em></p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack06.png
" alt=""></p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack07.png
" alt=""></p>
<h2 id="layers-above-s2d-stack">Layers above S2D Stack</h2>
<h3 id="volume-manager">Volume Manager</h3>
<p><em><strong>dmio.sys</strong></em>, <em><strong>volmgr.sys</strong></em></p>
<p>Volumes are created on top of the partition and on volumes you can then create filesystems and expose it to the components higher in the stack.</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack08.png
" alt=""></p>
<h3 id="volume-snapshot">Volume Snapshot</h3>
<p><em><strong>volsnap.sys</strong></em></p>
<p>Volsnap is the component that creates system provider for the volume <a href="https://learn.microsoft.com/en-us/windows-server/storage/file-server/volume-shadow-copy-service">shadow copy service (VSS)</a>. This service is controller by <em><strong>vssadmin.exe</strong></em></p>
<h3 id="bitlocker">BitLocker</h3>
<p><em><strong>fvevol.sys</strong></em></p>
<p>BitLocker is well known disk encryption software that is on the market since Windows Vista. In PowerShell you can expose volume status with <strong>Get-BitLockerVolume</strong> command.</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack09.png
" alt=""></p>
<h3 id="filter-drivers">Filter Drivers</h3>
<p>Interesting about filter drivers is, that all FileSystem drivers are actually filter drivers - special ones, File System Drivers - like <em><strong>REFS.sys</strong></em>, <em><strong>NTFS.sys</strong></em>, <em><strong>Exfat.sys</strong></em>.</p>
<p>You can learn more about filesystem using fsutil</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack10.png
" alt=""></p>
<p>There are also many first party and third party filter drivers. You can expose those with fltmc command</p>
<p><img src="

https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/StorageStack11.png
" alt=""></p>
<p>As you can see on above example, there are many filters like Cluster Shared Volume (CsvNSFlt, CsvFLT), deduplication (Dedup), shared vhd (svhdxflt), storage QoS (storqosflt) and many more. Each filter driver has defined altitude and 3rd parties can <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ifs/allocated-altitudes">reserve theirs</a>.</p>

</div>
</div>


  
  
  
  

  
  

  


<span class="td-footer__copyright">
    <span class="td-footer__authors"><a href="https://www.dell.com/en-us/lp/legal/site-terms-of-use-copyright">Copyright © 2026 Dell Inc.</a> | <a href="https://www.dell.com/en-us/lp/legal/terms-of-sale">Terms of Sale</a> | <a href="https://www.dell.com/en-us/lp/legal/policies-privacy">Privacy Statement</a> | <a href="https://www.dell.com/en-us/lp/do-not-sell-my-info">Do Not Sell or Share My Personal Information</a> | <a href="https://www.dell.com/en-us/lp/legal/policies-cookies-ads-emails">Cookies, Ads &amp; Emails</a> | <a href="https://www.dell.com/en-us/lp/legal/terms">Legal &amp; Regulatory</a></span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>

          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/dell/azurestack-docs" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">
    <span class="td-footer__authors"><a href="https://www.dell.com/en-us/lp/legal/site-terms-of-use-copyright">Copyright © 2026 Dell Inc.</a> | <a href="https://www.dell.com/en-us/lp/legal/terms-of-sale">Terms of Sale</a> | <a href="https://www.dell.com/en-us/lp/legal/policies-privacy">Privacy Statement</a> | <a href="https://www.dell.com/en-us/lp/do-not-sell-my-info">Do Not Sell or Share My Personal Information</a> | <a href="https://www.dell.com/en-us/lp/legal/policies-cookies-ads-emails">Cookies, Ads &amp; Emails</a> | <a href="https://www.dell.com/en-us/lp/legal/terms">Legal &amp; Regulatory</a></span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src='/azurestack-docs/js/dark-mode-custom.js'></script>
<script src="https://wturner123.github.io/azurestack-docs/js/main.min.403ff095218c662472dab60ed98ecbb19431682de5ac7c6159891241cd366af5.js" integrity="sha256-QD/wlSGMZiRy2rYO2Y7LsZQxaC3lrHxhWYkSQc02avU=" crossorigin="anonymous"></script>
<script src='/azurestack-docs/js/prism.js'></script>
<script src='/azurestack-docs/js/tabpane-persist.js'></script>
<script>

    var offlineSearch = document.querySelector('input[data-offline-search-index-json-src*="offline-search"]');
    offlineSearch.setAttribute('data-offline-search-index-json-src', offlineSearch.getAttribute('data-offline-search-index-json-src').replace('azurestack-docs/azurestack-docs', 'azurestack-docs'));

</script>


<script src='/azurestack-docs/js/cookie-consent.js'></script>

  </body>
</html>
