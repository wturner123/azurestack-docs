<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="alternate" type="application/rss&#43;xml" href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/adfsspn/index.xml">
<link rel="alternate" type="text/html" href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/adfsspn/_print/">
<meta name="robots" content="index, follow">


<link rel="shortcut icon" href="https://wturner123.github.io/azurestack-docs/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="https://wturner123.github.io/azurestack-docs/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="https://wturner123.github.io/azurestack-docs/favicons/android-192x192.png" sizes="192x192">

<title>How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell | Solutions for Microsoft Azure Stack</title>
<meta name="description" content="Dell Technologies (Dell) Azure Stack documentation pages">
<meta property="og:url" content="https://wturner123.github.io/azurestack-docs/docs/hub/howto/adfsspn/">
  <meta property="og:site_name" content="Solutions for Microsoft Azure Stack">
  <meta property="og:title" content="How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell">
  <meta property="og:description" content="Overview This article explains how to create a service principal name (SPN) to manage Azure Stack Hub integrated with Active Directory Federation Services (AD FS) identity using PowerShell.
For more information about this process, visit Give an app access to Azure Stack Hub resources.
It will guide you through the creation of:
An AD FS application and the associated service principal object which represents the application’s identity within the Active Directory">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="website">

  <meta itemprop="name" content="How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell">
  <meta itemprop="description" content="Overview This article explains how to create a service principal name (SPN) to manage Azure Stack Hub integrated with Active Directory Federation Services (AD FS) identity using PowerShell.
For more information about this process, visit Give an app access to Azure Stack Hub resources.
It will guide you through the creation of:
An AD FS application and the associated service principal object which represents the application’s identity within the Active Directory">
  <meta itemprop="dateModified" content="2023-03-29T17:24:24+01:00">
  <meta itemprop="wordCount" content="2195">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell">
  <meta name="twitter:description" content="Overview This article explains how to create a service principal name (SPN) to manage Azure Stack Hub integrated with Active Directory Federation Services (AD FS) identity using PowerShell.
For more information about this process, visit Give an app access to Azure Stack Hub resources.
It will guide you through the creation of:
An AD FS application and the associated service principal object which represents the application’s identity within the Active Directory">



<link rel="preload" href="https://wturner123.github.io/azurestack-docs/scss/main.min.3e8e80404f921f6e12a533a2b75272b9dc07d9b5b7cf1253952cc07667961656.css" as="style">
<link href="https://wturner123.github.io/azurestack-docs/scss/main.min.3e8e80404f921f6e12a533a2b75272b9dc07d9b5b7cf1253952cc07667961656.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.7.1.min.js"
  integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
  crossorigin="anonymous"></script>
<script defer
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://wturner123.github.io/azurestack-docs/css/prism.css"/>
<link disabled id="prism-night-owl" rel="stylesheet" href="https://wturner123.github.io/azurestack-docs/css/prism-nightowl.css">
<link id="home-page-override" rel="stylesheet" href="https://wturner123.github.io/azurestack-docs/css/homepage.css">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-PXKTSNG8VW"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-PXKTSNG8VW');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="td-navbar js-navbar-scroll" data-bs-theme="dark">
<div class="container-fluid flex-column flex-md-row">
  <a class="navbar-brand" href="https://wturner123.github.io/azurestack-docs/"><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1017 132"><defs><style>.cls-1{fill:#fff}</style></defs><title>DellTech_Logo_Prm_Wht_rgb</title><path class="cls-1" d="M1015 84.89c0-12.23-6.8-17.66-20.39-20.38s-21.73-4.08-21.73-13.58c0-6.8 5.44-10.87 15-10.87 12.22.0 16.3 5.43 16.3 12.22l1.36 1.36h5.43l1.37-1.36c0-13.58-10.88-19-24.46-19-15 0-23.1 8.15-23.1 17.67.0 10.86 8.15 16.3 21.73 19s20.38 4.08 20.38 15c0 6.79-4.07 12.23-17.66 12.23-12.22.0-17.66-6.8-17.66-15l-1.35-1.36h-5.44l-1.35 1.36c0 12.23 9.5 21.74 25.8 21.74 17.66.0 25.82-8.15 25.82-19M956.58 71.31l1.36-1.37V65.87c0-19-10.87-32.61-29.89-32.61s-29.89 13.59-29.89 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38l-1.36-1.36h-5.43l-1.36 1.36c-2.72 8.15-8.16 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H907.67l-1.36-1.36c0-9.51 5.44-23.09 21.74-23.09s21.74 13.58 21.74 23.09zm-59.78 36.68V36l-1.36-1.35h-5.43L880.5 36v65.22l1.36 1.36h5.43zm0-78.8V14.24l-1.36-1.36h-5.43l-1.36 1.36v8.15l1.36 1.36h5.43zM837 97.12c-13.59.0-21.74-9.52-21.74-28.53S823.44 40.06 837 40.06s21.73 9.5 21.73 28.53S850.61 97.12 837 97.12M858.76 93c0 17.66-4.07 31.25-20.38 31.25-12.22.0-16.3-5.44-17.66-12.23l-1.35-1.36h-5.44l-1.36 1.36c1.36 10.87 9.51 19 25.81 19 17.67.0 28.53-10.87 28.53-38V36l-1.35-1.35h-4.08L860.12 36l-1.36 8.16H857.4c-2.71-5.43-9.5-10.87-21.74-10.87-19 0-28.53 15-28.53 35.33s9.52 35.32 28.53 35.32c12.24.0 19-5.43 21.74-10.87zm-88.3-53c13.58.0 23.09 10.87 23.09 28.53S784 97.12 770.46 97.12s-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32s-13.59-35.33-31.25-35.33-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-40.76-2.72V8.81l-1.36-1.36h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43zM680.8 40.06c13.58.0 23.09 10.87 23.09 28.53s-9.51 28.53-23.09 28.53-23.1-10.87-23.1-28.53 9.51-28.53 23.1-28.53m0 63.85c17.66.0 31.25-12.23 31.25-35.32S698.46 33.26 680.8 33.26s-31.25 12.23-31.25 35.33 13.59 35.32 31.25 35.32m-39.4-2.72V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.67 4.08-21.74 10.87h-1.36L592.49 36l-1.36-1.35h-4.08L585.7 36v65.22l1.35 1.36h5.44l1.36-1.36V64.51c0-15 6.79-24.45 21.73-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.37 1.36H640zm-69.29.0V60.43c0-17.66-9.51-27.17-24.45-27.17-9.52.0-17.66 4.08-21.74 10.87h-1.36V8.81L523.2 7.45h-5.43l-1.36 1.36v92.38l1.36 1.36h5.43l1.36-1.36V64.51c0-15 6.8-24.45 21.74-24.45 10.87.0 17.66 6.79 17.66 20.37v40.76l1.36 1.36h5.44zM455.28 68.59c0-19 9.5-28.53 23.09-28.53s19 8.15 20.38 16.29l1.35 1.37h5.44l1.36-1.37c-1.36-13.58-12.23-23.09-28.53-23.09-17.66.0-31.24 10.87-31.24 35.33s13.58 35.32 31.24 35.32c16.3.0 27.17-9.51 28.53-23.1l-1.36-1.36H500.1l-1.35 1.36C497.39 89 492 97.12 478.37 97.12s-23.09-9.52-23.09-28.53m-14.95 2.72 1.36-1.37V65.87c0-19-10.87-32.61-29.9-32.61s-29.88 13.59-29.88 32.61v2.72c0 19 9.51 35.32 31.25 35.32 19 0 25.81-12.23 27.17-20.38L439 82.17h-5.43l-1.36 1.36c-2.72 8.15-8.15 13.59-19 13.59-17.66.0-23.1-16.31-23.1-24.46l1.36-1.35zm-8.15-6.8H391.42l-1.36-1.36c0-9.51 5.44-23.09 21.73-23.09s21.75 13.58 21.75 23.09zM395.57 12.88V8.81l-1.36-1.36H323.56L322.2 8.81v4.07l1.36 1.36h29.89l1.36 1.36v85.59l1.36 1.36h5.43l1.36-1.36V15.6l1.36-1.36h29.89z"/><path class="cls-1" d="M322.2 83.65v18.9H260.85V7.45h21.6v76.2zM38.55 102.55A47.57 47.57.0 0084.58 67l53.8 42 53.77-42v35.56H253.5V83.65H213.75V7.45h-21.6V43L140.58 83.3l-11.54-9L153.73 55l26.89-21-15.35-12-51.58 40.3-11.53-9L153.73 13 138.38 1 84.58 43a47.57 47.57.0 00-46-35.58H0v95.1zM21.6 83.65V26.35H38.55c14.33.0 26 12.83 26 28.65s-11.67 28.65-26 28.65z"/></svg></span><span class="navbar-brand__name">Solutions for Microsoft Azure Stack</span></a>
  <div class="td-navbar-nav-scroll ms-md-auto" id="main_navbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link active" href="https://wturner123.github.io/azurestack-docs/docs/"><span>Dell Technologies Solutions for Microsoft Azure Stack</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="https://github.com/dell/azurestack-docs" target="_blank" rel="noopener"><i class='fab fa-github fa-lg'></i><span>GitHub</span></a>
      </li>
      <li class="td-light-dark-menu nav-item dropdown">
        <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="check2" viewBox="0 0 16 16">
    <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"/>
  </symbol>
  <symbol id="circle-half" viewBox="0 0 16 16">
    <path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
  </symbol>
  <symbol id="moon-stars-fill" viewBox="0 0 16 16">
    <path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
    <path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
  </symbol>
  <symbol id="sun-fill" viewBox="0 0 16 16">
    <path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
  </symbol>
</svg>

<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center"
        id="bd-theme"
        type="button"
        aria-expanded="false"
        data-bs-toggle="dropdown"
        data-bs-display="static"
        aria-label="Toggle theme (auto)">
  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text">
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#sun-fill"></use></svg>
      Light
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
      <svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"></use></svg>
      Dark
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
  <li>
    <button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
      <svg class="bi me-2 opacity-50"><use href="#circle-half"></use></svg>
      Auto
      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg>
    </button>
  </li>
</ul>

      </li>
      </ul>
  </div>
  <div class="d-none d-lg-block">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="https://wturner123.github.io/azurestack-docs/offline-search-index.4954fc847f21e4794036dd6240cf436d.json"
    data-offline-search-base-href="https://wturner123.github.io/azurestack-docs/"
    data-offline-search-max-results="10"
  >
</div>
  </div>
</div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
            <div id="td-sidebar-menu" class="td-sidebar__inner">
  <form class="td-sidebar__search d-flex align-items-center">
    <div class="td-search td-search--offline">
  <div class="td-search__icon"></div>
  <input
    type="search"
    class="td-search__input form-control"
    placeholder="Search this site…"
    aria-label="Search this site…"
    autocomplete="off"
    
    data-offline-search-index-json-src="https://wturner123.github.io/azurestack-docs/offline-search-index.4954fc847f21e4794036dd6240cf436d.json"
    data-offline-search-base-href="https://wturner123.github.io/azurestack-docs/"
    data-offline-search-max-results="10"
  >
</div>
    <button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type="button" data-bs-toggle="collapse" data-bs-target="#td-section-nav" aria-controls="td-section-nav" aria-expanded="false" aria-label="Toggle section navigation">
    </button>
  </form>
  <nav class="td-sidebar-nav collapse" id="td-section-nav">
    <ul class="td-sidebar-nav__section pe-md-3 ul-0">
      <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docs-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id="m-docs"><span class="">Dell Technologies Solutions for Microsoft Azure Stack</span></a>
  <ul class="ul-1">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docshub-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshub"><span class="">Azure Stack Hub</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshubreleaseartifacts-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts"><span class="">Release Artifacts</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleaseartifacts2502-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2502/" title="Release Artifacts for 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts2502"><span class="">2502</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleaseartifacts250214g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2502/14g/" title="Release Artifacts for 14G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts250214g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleaseartifacts250216g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2502/16g/" title="Release Artifacts for 16G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts250216g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleaseartifacts2411-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2411/" title="Release Artifacts for 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts2411"><span class="">2411</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleaseartifacts241114g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2411/14g/" title="Release Artifacts for 14G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts241114g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleaseartifacts241116g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2411/16g/" title="Release Artifacts for 16G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts241116g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleaseartifacts2407-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2407/" title="Release Artifacts for 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts2407"><span class="">2407</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleaseartifacts240714g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releaseartifacts/2407/14g/" title="Release Artifacts for 14G - 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleaseartifacts240714g"><span class="">14G</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshubreleasenotes-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes"><span class="">Release Notes</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleasenotes2502-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2502/" title="Release Notes for 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes2502"><span class="">2502</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleasenotes250214g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2502/14g/" title="Release Notes for 14G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes250214g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleasenotes250216g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2502/16g/" title="Release Notes for 16G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes250216g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleasenotes2411-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2411/" title="Release Notes for 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes2411"><span class="">2411</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleasenotes241114g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2411/14g/" title="Release Notes for 14G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes241114g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleasenotes241116g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2411/16g/" title="Release Notes for 16G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes241116g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubreleasenotes2407-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2407/" title="Release Notes for 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes2407"><span class="">2407</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubreleasenotes240714g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/releasenotes/2407/14g/" title="Release Notes for 14G - 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubreleasenotes240714g"><span class="">14G</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshubsupportmatrix-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix"><span class="">Support Matrix</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubsupportmatrix2502-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2502/" title="Support Matrix for 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix2502"><span class="">2502</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubsupportmatrix250214g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2502/14g/" title="Support Matrix for 14G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix250214g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubsupportmatrix250216g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2502/16g/" title="Support Matrix for 16G - 2502" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix250216g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubsupportmatrix2411-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2411/" title="Support Matrix for 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix2411"><span class="">2411</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubsupportmatrix241114g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2411/14g/" title="Support Matrix for 14G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix241114g"><span class="">14G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubsupportmatrix241116g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2411/16g/" title="Support Matrix for 16G - 2411" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix241116g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshubsupportmatrix2407-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2407/" title="Support Matrix for 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix2407"><span class="">2407</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubsupportmatrix240714g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/supportmatrix/2407/14g/" title="Support Matrix for 14G - 2407" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubsupportmatrix240714g"><span class="">14G</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshubpatchandupdate-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/patchandupdate/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubpatchandupdate"><span class="">Patch and Update</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshubpatchandupdate16g-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/patchandupdate/16g/" title="Patch and Update for 16G" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubpatchandupdate16g"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id="m-docshubhowto-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshubhowto"><span class="">How To</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id="m-docshubhowtoadfsspn-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/adfsspn/" title="How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell" class="align-left ps-0 active td-sidebar-link td-sidebar-link__section" id="m-docshubhowtoadfsspn"><span class="td-sidebar-nav-active-item">Create AD FS SPN</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docshci-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshci"><span class="">Azure Stack HCI</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshciplanningazurestack-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack"><span class="">Planning Azure Stack</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack01-operating-system-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/01-operating-system/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack01-operating-system"><span class="">01. Operating System</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack02-supporting-infrastructure-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/02-supporting-infrastructure/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack02-supporting-infrastructure"><span class="">02. Supporting Infrastructure</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack03-deployment-models-and-workloads-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/03-deployment-models-and-workloads/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack03-deployment-models-and-workloads"><span class="">03. Planning Deployment Models and Workloads</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack04-network-architecture-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/04-network-architecture/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack04-network-architecture"><span class="">04. Planning Network Architecture</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack05-storage-capacity-planning-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/05-storage-capacity-planning/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack05-storage-capacity-planning"><span class="">05. Storage Capacity Planning</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshciplanningazurestack06-hardware-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/planningazurestack/06-hardware/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshciplanningazurestack06-hardware"><span class="">06. Hardware</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcistoragestack-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcistoragestack"><span class="">Storage Stack</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcistoragestackoverview-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/overview/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcistoragestackoverview"><span class="">Storage Stack Overview</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcistoragestack01-layers-below-s2d-stack-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/01-layers-below-s2d-stack/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcistoragestack01-layers-below-s2d-stack"><span class="">Layers Below S2D Stack</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcistoragestack01-layers-below-s2d-stack01-storagedevices-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/storagestack/01-layers-below-s2d-stack/01-storagedevices/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcistoragestack01-layers-below-s2d-stack01-storagedevices"><span class="">Storage Devices</span></a>
</li>
  </ul>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcisupportmatrix-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix"><span class="">Support Matrix</span></a>
  <ul class="ul-3 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcisupportmatrix2503-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2503/" title="Azure Stack HCI Support Matrix (2503)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix2503"><span class="">2503</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrix250314g-15g_hci-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2503/14g-15g_hci/" title="Azure Stack HCI Support Matrix for 14G-15G (2503)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix250314g-15g_hci"><span class="">14G-15G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrix250316g_hci-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2503/16g_hci/" title="Azure Stack HCI Support Matrix for 16G (2503)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix250316g_hci"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcisupportmatrix2412-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2412/" title="Azure Stack HCI Support Matrix (2412)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix2412"><span class="">2412</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrix241214g-15g_hci-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2412/14g-15g_hci/" title="Azure Stack HCI Support Matrix for 14G-15G (2412)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix241214g-15g_hci"><span class="">14G-15G</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrix241216g_hci-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/2412/16g_hci/" title="Azure Stack HCI Support Matrix for 16G (2412)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrix241216g_hci"><span class="">16G</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child collapse" id="m-docshcisupportmatrixarchive-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/archive/" title="Azure Stack HCI Support Matrix (Archive)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrixarchive"><span class="">Archive</span></a>
  <ul class="ul-4 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrixarchivews2016-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/supportmatrix/archive/ws2016/" title="Azure Stack HCI Firmware and Driver Matrix for Legacy Windows Server Operating Systems (Windows Server 2016)" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrixarchivews2016"><span class="">Windows Server 2016</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcisupportmatrixsbereleasenotes-li">
  <a href="https://www.dell.com/support/kbdoc/en-us/000224407/dell-for-microsoft-azure-stack-hci-ax-hardware-updates-release-notes" title="Dell Solution Builder Extensions for Azure Stack HCI Integrated System AX Server Release Notes" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcisupportmatrixsbereleasenotes"><span class="">SBE Release Notes</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docshcibiosandidrac-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/hci/biosandidrac/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docshcibiosandidrac"><span class="">BIOS and iDRAC configuration recommendations</span></a>
</li>
  </ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id="m-docsreferences-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/references/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docsreferences"><span class="">References</span></a>
  <ul class="ul-2 foldable">
    <li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id="m-docsreferencescontributionguidelines-li">
  <a href="https://wturner123.github.io/azurestack-docs/docs/references/contributionguidelines/" class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id="m-docsreferencescontributionguidelines"><span class="">Contribution Guidelines</span></a>
</li>
  </ul>
</li>
  </ul>
</li>
    </ul>
  </nav>
</div>

          </aside>
          <aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
            <div class="td-page-meta ms-2 pb-1 pt-2 mb-0">
<a href="https://github.com/dell/azurestack-docs/tree/main/content/en/docs/hub/HowTo/ADFSSPN/_index.md" class="td-page-meta--view td-page-meta__view" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
  <a href="https://github.com/dell/azurestack-docs/edit/main/content/en/docs/hub/HowTo/ADFSSPN/_index.md" class="td-page-meta--edit td-page-meta__edit" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit</a>
  <a href="https://github.com/dell/azurestack-docs/new/main/content/en/docs/hub/HowTo/ADFSSPN?filename=change-me.md&amp;value=---%0Atitle%3A&#43;%22Long&#43;Page&#43;Title%22%0AlinkTitle%3A&#43;%22Short&#43;Nav&#43;Title%22%0Aweight%3A&#43;100%0Adescription%3A&#43;%3E-%0A&#43;&#43;&#43;&#43;&#43;Page&#43;description&#43;for&#43;heading&#43;and&#43;indexes.%0A---%0A%0A%23%23&#43;Heading%0A%0AEdit&#43;this&#43;template&#43;to&#43;create&#43;your&#43;new&#43;page.%0A%0A%2A&#43;Give&#43;it&#43;a&#43;good&#43;name%2C&#43;ending&#43;in&#43;%60.md%60&#43;-&#43;e.g.&#43;%60getting-started.md%60%0A%2A&#43;Edit&#43;the&#43;%22front&#43;matter%22&#43;section&#43;at&#43;the&#43;top&#43;of&#43;the&#43;page&#43;%28weight&#43;controls&#43;how&#43;its&#43;ordered&#43;amongst&#43;other&#43;pages&#43;in&#43;the&#43;same&#43;directory%3B&#43;lowest&#43;number&#43;first%29.%0A%2A&#43;Add&#43;a&#43;good&#43;commit&#43;message&#43;at&#43;the&#43;bottom&#43;of&#43;the&#43;page&#43;%28%3C80&#43;characters%3B&#43;use&#43;the&#43;extended&#43;description&#43;field&#43;for&#43;more&#43;detail%29.%0A%2A&#43;Create&#43;a&#43;new&#43;branch&#43;so&#43;you&#43;can&#43;preview&#43;your&#43;new&#43;file&#43;and&#43;request&#43;a&#43;review&#43;via&#43;Pull&#43;Request.%0A" class="td-page-meta--child td-page-meta__child" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
  <a href="https://github.com/dell/azurestack-docs/issues/new?title=How%20to%20create%20a%20service%20principal%20name%20for%20Azure%20Stack%20Hub%20integrated%20with%20Active%20Directory%20Federation%20Services%20identity%20using%20PowerShell" class="td-page-meta--issue td-page-meta__issue" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Open an issue</a>
  <a id="print" href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/adfsspn/_print/"><i class="fa-solid fa-print fa-fw"></i> Print page</a>

</div>

            <div class="td-toc">
        <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#overview">Overview</a>
          <ul>
            <li><a href="#prerequisites">Prerequisites</a></li>
          </ul>
        </li>
        <li><a href="#overview-of-the-creation-process-for-azure-stack-hub-spn">Overview of the creation process for Azure Stack Hub SPN</a></li>
        <li><a href="#create-azure-stack-hub-spn">Create Azure Stack Hub SPN</a></li>
      </ul>
    </li>
  </ul>
</nav>
      </div>
    
            

          </aside>
          <main class="col-12 col-md-9 col-xl-8 ps-md-5" role="main">
            
  

            <nav aria-label="breadcrumb" class="td-breadcrumbs">
  <ol class="breadcrumb">
  <li class="breadcrumb-item">
    <a href="https://wturner123.github.io/azurestack-docs/docs/">Dell Technologies Solutions for Microsoft Azure Stack</a></li>
  <li class="breadcrumb-item">
    <a href="https://wturner123.github.io/azurestack-docs/docs/hub/">Azure Stack Hub</a></li>
  <li class="breadcrumb-item">
    <a href="https://wturner123.github.io/azurestack-docs/docs/hub/howto/">How To</a></li>
  <li class="breadcrumb-item active" aria-current="page">
    Create AD FS SPN</li>
  </ol>
</nav>
            
<div class="td-content">
	<h1>How to create a service principal name for Azure Stack Hub integrated with Active Directory Federation Services identity using PowerShell</h1>
  
	<header class="article-meta">
		
</header>
	<h3 id="overview">Overview</h3>
<p>This article explains how to create a service principal name (SPN) to manage Azure Stack Hub integrated with Active Directory Federation Services (AD FS) identity using PowerShell.</p>
<p>For more information about this process, visit <a href="https://learn.microsoft.com/en-us/azure-stack/operator/give-app-access-to-resources?tabs=az1%2Caz2&amp;pivots=state-disconnected">Give an app access to Azure Stack Hub resources</a>.</p>
<p>It will guide you through the creation of:</p>
<ul>
<li>
<p>An AD FS application and the associated service principal object which represents the application&rsquo;s identity within the Active Directory</p>
</li>
<li>
<p>Role assignment</p>
</li>
</ul>
<h4 id="prerequisites">Prerequisites</h4>
<p>Prerequisites from a Windows-based external client are:</p>
<ul>
<li>
<p>PowerShell 7.x and the Azure Stack Hub compatible PowerShell modules</p>
<ul>
<li><a href="https://learn.microsoft.com/en-us/azure-stack/operator/powershell-install-az-module">Install PowerShell Az module for Azure Stack Hub</a></li>
</ul>
</li>
<li>
<p><a href="https://learn.microsoft.com/en-us/azure-stack/operator/azure-stack-integrate-identity">Active Directory Federation Services identity integrated with Azure Stack Hub deployment</a></p>
</li>
</ul>
<h3 id="overview-of-the-creation-process-for-azure-stack-hub-spn">Overview of the creation process for Azure Stack Hub SPN</h3>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">NOTE</h4>

    <p>The procedure provided is designed for Azure Stack Hub Operators as it requires Privileged Endpoint (PEP) access as well as assumes the <em>Default Provider Subscription</em> and the Administrator Azure Resource Manager endpoint as the defaults; however, the same mechanism can be applied to the <strong>User Subscriptions</strong> with minimal changes to the code.</p>
<p>If you want to assign a role the SPN for a <strong>User Subscription</strong>, replace the Administrator Azure Resource Manager endpoint with the Tenant Azure Resource Manager endpoint and the <em>Default Provider Subscription</em> with <em>Subscription Name</em> you want to modify.</p>


</div>

<ol>
<li>
<p>Declare your variables accordingly.</p>
</li>
<li>
<p>Log in to your Azure Stack Hub <em>Default Provider Subscription</em> with administrator user credentials (needs to have the <strong>Owner</strong> role).


<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">CAUTION</h4>

    <p>This requires interactive prompt as by default when using AD FS as your identity provider you cannot use user credentials in the non-interactive way.</p>
<p>This is the main reason why you would want to create an SPN so that you can automate your operations.</p>


</div>
</p>
</li>
<li>
<p>Create your AD FS application/service principal.</p>
</li>
<li>
<p>Assign the appropriate <strong>Role</strong> to your service principal.</p>
</li>
</ol>


<div class="alert alert-primary" role="alert">
<h4 class="alert-heading">NOTE</h4>

    <p>As a bonus, we include an example of how to assign the <strong>Owner</strong> role to an AD FS group</p>
<p>The current <code>AzureStack</code> modules do not support it natively, but this example will show you how to do it via API.</p>
<p>It is the preferred method of assigning roles, you should assign roles to a group rather than individual users.</p>


</div>

<ol start="5">
<li>
<p>Log in to your Azure Stack Hub <em>Default Provider Subscription</em> using the SPN account.</p>
</li>
<li>
<p>Verify SPN authentication and the role assignment.</p>
</li>
</ol>
<h3 id="create-azure-stack-hub-spn">Create Azure Stack Hub SPN</h3>

  
  
  
<ul class="nav nav-tabs" id="tabs-3" role="tablist">
  <li class="nav-item">
      <button class="nav-link disabled"
          id="tabs-03-00-tab" data-bs-toggle="tab" data-bs-target="#tabs-03-00" role="tab"
          aria-controls="tabs-03-00" aria-selected="false">
        <strong>Service Principal credential</strong>:
      </button>
    </li><li class="nav-item">
      <button class="nav-link active"
          id="tabs-03-01-tab" data-bs-toggle="tab" data-bs-target="#tabs-03-01" role="tab"
          data-td-tp-persist="certificate" aria-controls="tabs-03-01" aria-selected="true">
        Certificate
      </button>
    </li><li class="nav-item">
      <button class="nav-link"
          id="tabs-03-02-tab" data-bs-toggle="tab" data-bs-target="#tabs-03-02" role="tab"
          data-td-tp-persist="client secret" aria-controls="tabs-03-02" aria-selected="false">
        Client Secret
      </button>
    </li>
</ul>

<div class="tab-content" id="tabs-3-content">
    <div class="tab-body tab-pane fade"
        id="tabs-03-00" role="tabpanel" aria-labelled-by="tabs-03-00-tab" tabindex="3">
        
    </div>
    <div class="tab-body tab-pane fade show active"
        id="tabs-03-01" role="tabpanel" aria-labelled-by="tabs-03-01-tab" tabindex="3">
        <h4 id="create-a-pfx-certificate">Create a PFX Certificate</h4>
<pre><code class="language-PowerShell">#region Declare variables

$CertificateName = "ADFSAutomationCert"

$CertStore = "cert:\LocalMachine\My" # This can also be "cert:\CurrentUser\My" but in general service accounts cannot access CurrentUser cert store

$CertSubject = "CN=$CertificateName"

$PfxFilePath = "C:\Temp"

if (-not (Test-Path -Path $PfxFilePath)) {

    New-Item -ItemType Directory -Path $PfxFilePath -Force | Out-Null

}

$PfxFilePathFull = Join-Path -Path $PfxFilePath -ChildPath "$($CertificateName).pfx"

$PfxPassword = '""' | ConvertTo-SecureString -AsPlainText -Force # replace "" with an actual password or leave "" for it to be blank

#endregion

#region Create certificate to pass into new Application

$ExpiryDate = (Get-Date).AddDays(365) # You can change this to whatever fits your security profile better, default is 1 year

$Cert = New-SelfSignedCertificate -CertStoreLocation $CertStore -Subject $CertSubject -KeySpec KeyExchange -NotAfter $ExpiryDate

Write-Verbose -Message "Certificate ""$($Cert.Subject)"" with start date ""$($Cert.NotBefore)"" and end date ""$($Cert.NotAfter)"" created at ""$($PfxFilePathFull)""."

#endregion

#region Get a cert object from a .pfx file - you need it to create the SPN to begin with

$Cert = Get-PfxCertificate -FilePath $PfxFilePathFull -Password $PfxPassword

#endregion

#region Optional steps

#region Export the certificate so that you can import it on other environments

try {

    Export-PfxCertificate -Cert $Cert.PsPath -FilePath $PfxFilePathFull -Password $PfxPassword -ErrorAction Stop | Out-Null

} catch {

    throw "Failed to export certificate to ""$($PfxFilePathFull)"":`n$($_.Exception.Message)"

}

#endregion

#region Import the certificate into the certificate store on another environment

Import-PfxCertificate -CertStoreLocation $CertStore -FilePath $PfxFilePathFull -Password $PfxPassword -Exportable

#endregion

#endregion

</code></pre>
<h4 id="create-azure-stack-hub-spn-that-uses-certificate-credential">Create Azure Stack Hub SPN that uses certificate credential</h4>
<pre><code class="language-PowerShell">#region Declare variables

$CertificateName = "ADFSAutomationCert"

$PfxFilePath = "C:\Temp"

$PfxFilePathFull = Join-Path -Path $PfxFilePath -ChildPath "$($CertificateName).pfx"

$PfxPassword = '""' | ConvertTo-SecureString -AsPlainText -Force

$CertificateObject = Get-PfxCertificate -FilePath $PfxFilePathFull -Password $PfxPassword

$CertificateThumbprint = $CertificateObject.Thumbprint

if (!$CertificateThumbprint) {

    throw "Failed to obtain a thumbprint from certificate: $($PfxFilePathFull)"

}

$CloudAdminUsername = "CloudAdmin@azurestack.local"

[SecureString]$CloudAdminPassword = ConvertTo-SecureString "Password123!" -AsPlainText -Force

$ApplicationName = "ADFSAppCert"

$AzureStackRole = "Owner"

$ADGroupName = "AzureStackHubOwners"

$AzureStackAdminArmEndpoint = "https://adminmanagement.local.azurestack.external/"

$EnvironmentName = "AzureStackAdmin"

$PepCreds = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $CloudAdminUsername, $CloudAdminPassword

$PepIPAddress = "x.x.x.224" # e.g. 10.5.30.224

#endregion

#region Register and set an Az environment that targets your Azure Stack Hub instance

Write-Output -InputObject "Connecting to Azure Stack Hub Admin Management Endpoint - $(AzureStackAdminArmEndpoint)"

$null = Add-AzEnvironment -Name $EnvironmentName -ARMEndpoint $AzureStackAdminArmEndpoint

$null = Connect-AzAccount -Environment $EnvironmentName -UseDeviceAuthentication # Interactive prompt

if (((Get-AzContext).Subscription).Name -notlike "Default Provider Subscription") {

    throw "Failed to obtain access to the 'Default Provider Subscription'. Please verify the user has been assigned the '$($AzureStackRole)' role for the 'Default Provider Subscription'."

}

#endregion

#region Create a PSSession to the Privileged Endpoint VM

Write-Output -InputObject "Create a PowerShell Session to the Privileged Endpoint VM"

$PepSession = New-PSSession -ComputerName $PepIPAddress -ConfigurationName PrivilegedEndpoint -Credential $PepCreds -SessionOption (New-PSSessionOption -Culture en-US -UICulture en-US)

#endregion

#region Check for existing SPN

Write-Output -InputObject "Check for existing SPN '$($ApplicationName)'"

$SPNObjectCheckJob = Invoke-Command -Session $PepSession -ScriptBlock { Get-GraphApplication } -AsJob | Wait-Job

if ($SPNObjectCheckJob.State -ne "Completed") {

    throw "$($SPNObjectCheckJob.ChildJobs | Receive-Job)"

}

$SPNObjectCheck = $SPNObjectCheckJob.ChildJobs.Output | Where-Object { $_.Name -like "Azurestack-$ApplicationName*" } | Select-Object -Last 1

#endregion

#region Create new SPN if one does not exist

if ($SPNObjectCheck) {

    Write-Output -InputObject "SPN details`n$($ApplicationName): $($SPNObjectCheck | Out-String)"

} else {

    Write-Output -InputObject "No existing SPN found"

    Write-Output -InputObject "Create new SPN '$($ApplicationName)'"

    $SPNObjectJob = Invoke-Command -Session $PepSession -ScriptBlock { New-GraphApplication -Name $using:ApplicationName -ClientCertificates $using:CertificateObject } -AsJob | Wait-Job

    if ($SPNObjectJob.State -ne "Completed") {

        throw "$($SPNObjectJob.ChildJobs | Receive-Job)"

    }

    $SPNObject = $SPNObjectJob.ChildJobs.Output

    Write-Output -InputObject "SPN details`n$($ApplicationName): $($SPNObject | Out-String)"

    $FullApplicationName = $SPNObject.ApplicationName

    #endregion

}

#region Assign SPN the 'Owner' role for the 'Default Provider Subscription'

Write-Output -InputObject "Assign SPN '$($ApplicationName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

if ($FullApplicationName) {

    $SPNADFSApp = Get-AzADServicePrincipal | Where-Object { $_.DisplayName -like "$($FullApplicationName)" }

} else {

    $SPNADFSApp = Get-AzADServicePrincipal | Where-Object { $_.DisplayName -like "*$($ApplicationName)*" } | Select-Object -Last 1

}

$SPNRoleAssignmentCheck = Get-AzRoleAssignment -ObjectId $SPNADFSApp.AdfsId

if (!($SPNRoleAssignmentCheck) -or ($SPNRoleAssignmentCheck.RoleDefinitionName -ne $AzureStackRole)) {

    $null = New-AzRoleAssignment -RoleDefinitionName $AzureStackRole -ServicePrincipalName $SPNADFSApp.ApplicationId.Guid

    #region Verify SPN has been assigned the 'Owner' role for the 'Default Provider Subscription'

    $SPNRoleAssignment = Get-AzRoleAssignment -ObjectId $SPNADFSApp.AdfsId

    if (!($SPNRoleAssignment) -or ($SPNRoleAssignment.RoleDefinitionName -ne $AzureStackRole)) {

        throw "Failed to assign SPN '$($ApplicationName)' the '$($AzureStackRole)' role for the Default Provider Subscription"

    }

    #endregion

}

#endregion

#region Assign AD group 'AzureStackOwners' the 'Owner' role for the 'Default Provider Subscription'

Write-Output -InputObject "Assign AD group '$($ADGroupName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

$ADGroup = Get-AzADGroup -DisplayNameStartsWith $ADGroupName

$SubId = (Get-AzSubscription -SubscriptionName "Default Provider Subscription").Id

$OwnerRoleId = (Get-AzRoleDefinition -Name $AzureStackRole).Id

$APIPayloadHash = @{

    "properties" = @{

        "roleDefinitionId" = "/subscriptions/$($SubId)/providers/Microsoft.Authorization/roleDefinitions/$($OwnerRoleId)"
        "principalId"      = "$($ADGroup.AdfsId)"

    }

} | ConvertTo-Json -Depth 50

$APIPath = "/subscriptions/$($SubId)/providers/Microsoft.Authorization/roleAssignments/$($OwnerRoleId)?api-version=2015-07-01"

$APIResponse = Invoke-AzRestMethod -Path $APIPath -Method "PUT" -Payload $APIPayloadHash

if ($APIResponse.StatusCode -ne "201") {

    throw "Failed to create role assignment for ""$($ADGroup.DisplayName)"" in subscription ""$($SubId)"" with role ""$($AzureStackRole)"" and role ID ""$($OwnerRoleId)"""

}

#endregion

#region Verify AD group 'AzureStackOwners' has been assigned the 'Owner' role for the 'Default Provider Subscription'

$ADGroupRoleAssignment = Get-AzRoleAssignment -ObjectId $ADGroup.AdfsId

if (!($ADGroupRoleAssignment) -or ($ADGroupRoleAssignment.RoleDefinitionName -ne $AzureStackRole)) {

    throw "Failed to assign AD group '$($ADGroupName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

}

#endregion

#region Obtain authentication information

# GUID of the directory tenant
$TenantId = (Get-AzContext).Tenant.Id

Write-Output -InputObject "TenantId: $($TenantId)"
Write-Output -InputObject ""
Write-Output -InputObject "ApplicationName: $($SPNADFSApp.DisplayName)"
Write-Output -InputObject ""
Write-Output -InputObject "ApplicationId: $($SPNADFSApp.ApplicationId.Guid)"
Write-Output -InputObject ""
Write-Output -InputObject "CertificateThumbprint: $($CertificateThumbprint)"
Write-Output -InputObject ""
Write-Output -InputObject "Admin ARM Endpoint: $($AzureStackAdminArmEndpoint)"

#endregion

#region Verify if SPN can authenticate to Azure Stack Hub Admin Management Endpoint

Write-Output -InputObject "Verify if SPN can authenticate to Azure Stack Hub Admin Management Endpoint"

$null = Clear-AzContext -Force

$null = Connect-AzAccount -Environment $EnvironmentName -ServicePrincipal -Tenant $TenantId -ApplicationId $SPNADFSApp.ApplicationId.Guid -CertificateThumbprint $CertificateThumbprint

if (((Get-AzContext).Subscription).Name -notlike "Default Provider Subscription") {

    throw "Failed to obtain access to the 'Default Provider Subscription'. Please verify the SPN has been assigned the '$($AzureStackRole)' role for the 'Default Provider Subscription'."

} else {

    Write-Output -InputObject "Your SPN can successfully authenticate with ARM Endpoint $($AzureStackAdminArmEndpoint) and has got access to the 'Default Provider Subscription'"

}

#endregion

#region Remove sessions

if ($PepSession) {

    Write-Output -InputObject "Removing PSSSession to the Privileged Endpoint"

    Remove-PSSession -Session $PepSession

}

$CheckContext = Get-AzContext | Where-Object { $_.Environment -like $EnvironmentName }

if ($CheckContext) {

    Write-Output -InputObject "Disconnecting from AzS Hub Admin Management Endpoint: $($CheckContext.Environment.ResourceManagerUrl)"

    $null = Disconnect-AzAccount

}

#endregion

</code></pre>

    </div>
    <div class="tab-body tab-pane fade"
        id="tabs-03-02" role="tabpanel" aria-labelled-by="tabs-03-02-tab" tabindex="3">
        



<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">CAUTION</h4>

    Using a client secret is less secure than using an X509 certificate credential. Not only is the authentication mechanism less secure, but it also typically requires embedding the secret in the client app source code. As such, for production apps, you&rsquo;re strongly encouraged to use a certificate credential.

</div>


<pre><code class="language-PowerShell">#region Declare variables

$CloudAdminUsername = "CloudAdmin@azurestack.local"

[SecureString]$CloudAdminPassword = ConvertTo-SecureString "Password123!" -AsPlainText -Force

$ApplicationName = "ADFSAppCert"

$AzureStackRole = "Owner"

$ADGroupName = "AzureStackHubOwners"

$AzureStackAdminArmEndpoint = "https://adminmanagement.local.azurestack.external/"

$EnvironmentName = "AzureStackAdmin"

$PepCreds = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $CloudAdminUsername, $CloudAdminPassword

$PepIPAddress = "x.x.x.224" # e.g. 10.5.30.224

#endregion

#region Register and set an Az environment that targets your Azure Stack Hub instance

Write-Output -InputObject "Connecting to Azure Stack Hub Admin Management Endpoint - $(AzureStackAdminArmEndpoint)"

$null = Add-AzEnvironment -Name $EnvironmentName -ARMEndpoint $AzureStackAdminArmEndpoint

$null = Connect-AzAccount -Environment $EnvironmentName -UseDeviceAuthentication # Interactive prompt

if (((Get-AzContext).Subscription).Name -notlike "Default Provider Subscription") {

    throw "Failed to obtain access to the 'Default Provider Subscription'. Please verify the user has been assigned the '$($AzureStackRole)' role for the 'Default Provider Subscription'."

}

#endregion

#region Create a PSSession to the Privileged Endpoint VM

Write-Output -InputObject "Create a PowerShell Session to the Privileged Endpoint VM"

$PepSession = New-PSSession -ComputerName $PepIPAddress -ConfigurationName PrivilegedEndpoint -Credential $PepCreds -SessionOption (New-PSSessionOption -Culture en-US -UICulture en-US)

#endregion

#region Check for existing SPN

Write-Output -InputObject "Check for existing SPN '$($ApplicationName)'"

$SPNObjectCheckJob = Invoke-Command -Session $PepSession -ScriptBlock { Get-GraphApplication } -AsJob | Wait-Job

if ($SPNObjectCheckJob.State -ne "Completed") {

    throw "$($SPNObjectCheckJob.ChildJobs | Receive-Job)"

}

$SPNObjectCheck = $SPNObjectCheckJob.ChildJobs.Output | Where-Object { $_.Name -like "Azurestack-$ApplicationName*" } | Select-Object -Last 1

#endregion

#region Create new SPN if one does not exist

if ($SPNObjectCheck) {

    Write-Output -InputObject "SPN details`n$($ApplicationName): $($SPNObjectCheck | Out-String)"

} else {

    Write-Output -InputObject "No existing SPN found"

    Write-Output -InputObject "Create new SPN '$($ApplicationName)'"

    $SPNObjectJob = Invoke-Command -Session $PepSession -ScriptBlock { New-GraphApplication -Name $using:ApplicationName -GenerateClientSecret } -AsJob | Wait-Job

    if ($SPNObjectJob.State -ne "Completed") {

        throw "$($SPNObjectJob.ChildJobs | Receive-Job)"

    }

    $SPNObject = $SPNObjectJob.ChildJobs.Output

    Write-Output -InputObject "SPN details`n$($ApplicationName): $($SPNObject | Out-String)"

    $FullApplicationName = $SPNObject.ApplicationName

    $SPNClientId = $SPNObject.ClientId

    $SPNClientSecret = $SPNObject.ClientSecret | ConvertTo-SecureString -AsPlainText -Force

    $SPNCreds = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $SPNClientId, $SPNClientSecret

    #endregion

}

#region Assign SPN the 'Owner' role for the 'Default Provider Subscription'

Write-Output -InputObject "Assign SPN '$($ApplicationName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

if ($FullApplicationName) {

    $SPNADFSApp = Get-AzADServicePrincipal | Where-Object { $_.DisplayName -like "$($FullApplicationName)" }

} else {

    $SPNADFSApp = Get-AzADServicePrincipal | Where-Object { $_.DisplayName -like "*$($ApplicationName)*" } | Select-Object -Last 1

}

$SPNRoleAssignmentCheck = Get-AzRoleAssignment -ObjectId $SPNADFSApp.AdfsId

if (!($SPNRoleAssignmentCheck) -or ($SPNRoleAssignmentCheck.RoleDefinitionName -ne $AzureStackRole)) {

    $null = New-AzRoleAssignment -RoleDefinitionName $AzureStackRole -ServicePrincipalName $SPNADFSApp.ApplicationId.Guid

    #region Verify SPN has been assigned the 'Owner' role for the 'Default Provider Subscription'

    $SPNRoleAssignment = Get-AzRoleAssignment -ObjectId $SPNADFSApp.AdfsId

    if (!($SPNRoleAssignment) -or ($SPNRoleAssignment.RoleDefinitionName -ne $AzureStackRole)) {

        throw "Failed to assign SPN '$($ApplicationName)' the '$($AzureStackRole)' role for the Default Provider Subscription"

    }

    #endregion

}

#endregion

#region Assign AD group 'AzureStackOwners' the 'Owner' role for the 'Default Provider Subscription'

Write-Output -InputObject "Assign AD group '$($ADGroupName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

$ADGroup = Get-AzADGroup -DisplayNameStartsWith $ADGroupName

$SubId = (Get-AzSubscription -SubscriptionName "Default Provider Subscription").Id

$OwnerRoleId = (Get-AzRoleDefinition -Name $AzureStackRole).Id

$APIPayloadHash = @{

    "properties" = @{

        "roleDefinitionId" = "/subscriptions/$($SubId)/providers/Microsoft.Authorization/roleDefinitions/$($OwnerRoleId)"
        "principalId"      = "$($ADGroup.AdfsId)"

    }

} | ConvertTo-Json -Depth 50

$APIPath = "/subscriptions/$($SubId)/providers/Microsoft.Authorization/roleAssignments/$($OwnerRoleId)?api-version=2015-07-01"

$APIResponse = Invoke-AzRestMethod -Path $APIPath -Method "PUT" -Payload $APIPayloadHash

if ($APIResponse.StatusCode -ne "201") {

    throw "Failed to create role assignment for ""$($ADGroup.DisplayName)"" in subscription ""$($SubId)"" with role ""$($AzureStackRole)"" and role ID ""$($OwnerRoleId)"""

}

#endregion

#region Verify AD group 'AzureStackOwners' has been assigned the 'Owner' role for the 'Default Provider Subscription'

$ADGroupRoleAssignment = Get-AzRoleAssignment -ObjectId $ADGroup.AdfsId

if (!($ADGroupRoleAssignment) -or ($ADGroupRoleAssignment.RoleDefinitionName -ne $AzureStackRole)) {

    throw "Failed to assign AD group '$($ADGroupName)' the '$($AzureStackRole)' role for the 'Default Provider Subscription'"

}

#endregion

#region Obtain authentication information

# GUID of the directory tenant
$TenantId = (Get-AzContext).Tenant.Id

Write-Output -InputObject "TenantId: $($TenantId)"
Write-Output -InputObject ""
Write-Output -InputObject "ApplicationName: $($SPNADFSApp.DisplayName)"
Write-Output -InputObject ""
Write-Output -InputObject "ApplicationId: $($SPNADFSApp.ApplicationId.Guid)"
Write-Output -InputObject ""
Write-Output -InputObject "ClientSecret: $($SPNObject.ClientSecret)"
Write-Output -InputObject ""
Write-Output -InputObject "Admin ARM Endpoint: $($AzureStackAdminArmEndpoint)"

#endregion

#region Verify if SPN can authenticate to Azure Stack Hub Admin Management Endpoint

Write-Output -InputObject "Verify if SPN can authenticate to Azure Stack Hub Admin Management Endpoint"

$null = Clear-AzContext -Force

$null = Connect-AzAccount -Environment $EnvironmentName -ServicePrincipal -Tenant $TenantId -Credential $SPNCreds

if (((Get-AzContext).Subscription).Name -notlike "Default Provider Subscription") {

    throw "Failed to obtain access to the 'Default Provider Subscription'. Please verify the SPN has been assigned the '$($AzureStackRole)' role for the 'Default Provider Subscription'."

} else {

    Write-Output -InputObject "Your SPN can successfully authenticate with ARM Endpoint $($AzureStackAdminArmEndpoint) and has got access to the 'Default Provider Subscription'"

}

#endregion

#region Remove sessions

if ($PepSession) {

    Write-Output -InputObject "Removing PSSSession to the Privileged Endpoint"

    Remove-PSSession -Session $PepSession

}

$CheckContext = Get-AzContext | Where-Object { $_.Environment -like $EnvironmentName }

if ($CheckContext) {

    Write-Output -InputObject "Disconnecting from AzS Hub Admin Management Endpoint: $($CheckContext.Environment.ResourceManagerUrl)"

    $null = Disconnect-AzAccount

}

#endregion

</code></pre>
  
    </div>
</div>


  <div class="section-index">
    
    
    </div>
<style>
  .feedback--answer {
    display: inline-block;
  }
  .feedback--answer-no {
    margin-left: 1em;
  }
  .feedback--response {
    display: none;
    margin-top: 1em;
  }
  .feedback--response__visible {
    display: block;
  }
</style>
<div class="d-print-none">
<h2 class="feedback--title">Feedback</h2>
<p class="feedback--question">Was this page helpful?</p>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-yes">Yes</button>
<button class="btn btn-primary mb-4 feedback--answer feedback--answer-no">No</button>
<p class="feedback--response feedback--response-yes">
  Glad to hear it! Please <a href="https://github.com/dell/azurestack-docs/issues/new?labels=feedback">tell us how we can improve</a>.
</p>
<p class="feedback--response feedback--response-no">
  Sorry to hear that. Please <a href="https://github.com/dell/azurestack-docs/issues/new?labels=feedback">tell us how we can improve</a>.
</p>
</div>
<script>
  const yesButton = document.querySelector('.feedback--answer-yes');
  const noButton = document.querySelector('.feedback--answer-no');
  const yesResponse = document.querySelector('.feedback--response-yes');
  const noResponse = document.querySelector('.feedback--response-no');
  const disableButtons = () => {
    yesButton.disabled = true;
    noButton.disabled = true;
  };
  const sendFeedback = (value) => {
    if (typeof gtag !== 'function') return;
    gtag('event', 'page_helpful', {
      'event_category': 'Helpful',
      'event_label': window.location.pathname,
      'value': value
    });
  };
  yesButton.addEventListener('click', () => {
    yesResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback( 100 );
  });
  noButton.addEventListener('click', () => {
    noResponse.classList.add('feedback--response__visible');
    disableButtons();
    sendFeedback(0);
  });
</script>
<br />
<div class="td-page-meta__lastmod">
  Last modified March 29, 2023: <a href="https://github.com/dell/azurestack-docs/commit/4299b2ea042fc951a7dda724b07c0679789e864c">Pub/minor adfs spn typo (#21) (4299b2ea)</a>
</div>
</div>

          </main>
        </div>
      </div>
      <footer class="td-footer row d-print-none">
  <div class="container-fluid">
    <div class="row mx-md-2">
      <div class="td-footer__left col-6 col-sm-4 order-sm-1">
        
      </div><div class="td-footer__right col-6 col-sm-4 order-sm-3">
        <ul class="td-footer__links-list">
  
  <li class="td-footer__links-item" data-bs-toggle="tooltip" title="GitHub" aria-label="GitHub">
    <a target="_blank" rel="noopener" href="https://github.com/dell/azurestack-docs" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

      </div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2">
        <span class="td-footer__copyright">&copy;
    2025
    <span class="td-footer__authors">The Dell Technologies</span></span><span class="td-footer__all_rights_reserved">All Rights Reserved</span><span class="ms-2"><a href="https://www.dell.com/learn/us/en/uscorp1/policies-privacy" target="_blank" rel="noopener">Privacy Policy</a></span>
      </div>
    </div>
  </div>
</footer>

    </div>
    <script src='https://wturner123.github.io/azurestack-docs/js/dark-mode-custom.js'></script>
<script src="https://wturner123.github.io/azurestack-docs/js/main.min.8bdc707530d61dee3a6fd659f8a422c05d2e2319377a8710175451ca21fa83b0.js" integrity="sha256-i9xwdTDWHe46b9ZZ&#43;KQiwF0uIxk3eocQF1RRyiH6g7A=" crossorigin="anonymous"></script>
<script src='https://wturner123.github.io/azurestack-docs/js/prism.js'></script>
<script src='https://wturner123.github.io/azurestack-docs/js/tabpane-persist.js'></script>
<script>

    var offlineSearch = document.querySelector('input[data-offline-search-index-json-src*="offline-search"]');
    offlineSearch.setAttribute('data-offline-search-index-json-src', offlineSearch.getAttribute('data-offline-search-index-json-src').replace('azurestack-docs/azurestack-docs', 'azurestack-docs'));

</script>

  </body>
</html>